---
title: "tennis_ex"
author: "James Wolpe"
date: "2023-09-28"
output: html_document
---

```{r}
##make a command that plots all matchups
comp_mod <- comp_glm(point_winner ~ 1, data = tennis_point,
                     p1 = "player1", p2 = "player2",
                     #p1_effects = ~ point_server1,
                     #p2_effects = ~ point_server2,
                     ref_player = "Andy Murray"
                     )


opp_player_list <- comp_mod[["data"]][["players_unique"]]

ref_player_list <- rep(comp_mod[["data"]][["ref_player"]], length(comp_mod[["data"]][["players_unique"]]))


player_of_interest <- 'Andy Murray'
data <- tennis_point

fitted_df <- data.frame(
  home = comp_mod[["data"]][["player1_vec"]],
  away = comp_mod[["data"]][["player2_vec"]],
  win_perc = comp_mod[["fitted.values"]]
)

aug_fitted_df <- augment(
  comp_mod,
  data = data,
  newdata = fitted_df,
  se_fit = TRUE,
  #FIXME if it defaults to this do I even need to include it
  type.predict = "link"
)

loli_teams <- data.frame(
  home = rep(player_of_interest, length(comp_mod[["data"]][["players_unique"]])),
  away = comp_mod[["data"]][["players_unique"]]
) %>% filter(home != away)

joined_df <- left_join(loli_teams, distinct(aug_fitted_df), by = c("home", "away"))

joined_df_1 <- joined_df %>% 
  mutate( 
    win_perc_1 = exp(.fitted)/ (1+exp(.fitted)),
    u_bound = exp(.fitted + .se.fit)/ (1+ exp(.fitted + .se.fit)),
    l_bound = exp(.fitted - .se.fit)/ (1+ exp(.fitted - .se.fit))
  ) %>%
  mutate(away = fct_reorder(away, win_perc))

ggplot(joined_df_1, aes(x = away, y = win_perc)) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = l_bound, ymax = u_bound)) +
  labs(x = "Player",
       y = "Win Percentage",
       title = paste(player_of_interest, "Plot"))+
  scale_y_continuous(labels = scales::percent_format(scale = 100))+
  theme_bw() +
  coord_flip()


```

